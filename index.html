<!doctype html>
<html lang="en">
<head>
    <link rel="stylesheet" href="https://openlayers.org/en/v4.6.4/css/ol.css" type="text/css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script src="https://openlayers.org/en/v4.6.4/build/ol.js" type="text/javascript"></script>
    <style>
        .html .body .map {
            height: 100%;
            width: 100%;
            position: fixed;
        }
        .modal-title {
            text-align: center;
            width: 100%;
        }
        #modal-body-text {
            text-align: center;
            padding-bottom: 50px;
        }
        .modal-dialog {
            max-width: 900px;
        }
        .modal-content {
            height: 300px;
        }
        .legend {
            position: absolute;
            z-index: 1;
            margin-top: 150px;
            padding-left: 15px;
        }
    </style>
    
    <title>Waterhackathon 2018</title>
</head>
<body>
    <div id="map" class="map">
        <div class="legend">
            <div class="form-check">
                <label class="form-check-label">
                    <input class="form-check-input" type="checkbox" value="" checked>
                    Fluvial flood plain, prob 0,1%
                </label>
            </div>
            <div class="form-check disabled">
                <label class="form-check-label">
                    <input class="form-check-input" type="checkbox" value="">
                    Fluvial flood plain, prob 10%
                </label>
            </div>
        </div>
    </div>
    <div id="myModal" class="modal fade" role="dialog">
        <div class="modal-dialog">
            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Hack Flood</h4>
                </div>
                <div class="modal-body">
                    <p id="modal-body-text">Public flood awareness</p><br>
                    <div class="input-group input-group-lg">
                        <div class="input-group-prepend"></div>
                        <input type="text" placeholder="Pori" class="form-control" aria-label="Large" aria-describedby="inputGroup-sizing-sm">
                        <button type="button" id="go-button"class="btn btn-default" data-dismiss="modal">Go</button>
                    </div>
                    
                </div>
                
            </div>
        </div>
    </div>
    
    
    
    <script type="text/javascript">
        
        $(window).on("load", function(){        
            $('#myModal').modal('show');
        }); 
        var vectorSource = new ol.source.Vector({
            format: new ol.format.GeoJSON(),
            url: function() {
                return 'http://paikkatieto.ymparisto.fi/arcgis/rest/services/Tulva/Tulvariskiaineistot_perusskenaariot_toistuvuuksittain/MapServer/9/query?where=1%3D1&text=&objectIds=&time=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelIntersects&relationParam=&outFields=*&returnGeometry=true&returnTrueCurves=false&maxAllowableOffset=&geometryPrecision=&outSR=&returnIdsOnly=false&returnCountOnly=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&returnZ=false&returnM=false&gdbVersion=&returnDistinctValues=false&resultOffset=&resultRecordCount=&queryByDistance=&returnExtentsOnly=false&datumTransformation=&parameterValues=&rangeValues=&f=geojson';
            }
        });
        
        
        var raster = new ol.layer.Tile({
            source: new ol.source.XYZ({
                url: 'https://services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer/tile/{z}/{y}/{x}'
            })
        });
        
        var fluvial_flood_plain_1000 = new ol.layer.Image({
            title : 'Määritetyt tulva-alueet, meritulva, 1 1000a',
            opacity : 0.6,
            visible : true,
            source: new ol.source.ImageWMS({
                url: 'http://paikkatieto.ymparisto.fi/arcgis/services/Tulva/Tulvariskiaineistot_perusskenaariot_toistuvuuksittain/MapServer/WmsServer?',
                params: {
                    'LAYERS': '50',
                    
                    'VERSION': '1.3.0'
                }
                
            })
        });
        
        var roads_under_flood_1000 = new ol.layer.Vector({
            source: vectorSource,
            style: new ol.style.Style({
                stroke: new ol.style.Stroke({
                    color: 'rgba(255, 75, 75, 0.7)',
                    width: 2
                })
            })
        });
        
        var map = new ol.Map({
            target: 'map',
            layers: [raster
            ],
            view: new ol.View({
                center: ol.proj.fromLonLat([28.843625187, 64.189471432]),
                zoom: 6
            })
        });

        var myEl = document.getElementById('go-button');

        myEl.addEventListener('click', function() {
            map.addLayer(roads_under_flood_1000);
            map.addLayer(fluvial_flood_plain_1000);
            map.setView( new ol.View({
                center: ol.proj.fromLonLat([21.800925866, 61.489358102]),
                zoom: 12
            }));
        }, false);

    </script>
</body>
</html>